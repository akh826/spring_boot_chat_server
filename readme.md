# Spring Boot Chat Server

A Simple Springboot chat server, most code and text and animation generated by github copilot in vscode

---

## Deploy to AWS Lightsail

### 1. 準備環境

- 安裝 JDK

  ```sh
  sudo apt update
  sudo apt install openjdk-17-jdk   # 根據項目需求選擇版本（如 11/17）
  java -version                     # 驗證安裝
  ```

- 安裝 MySQL（可選，如需資料庫）

  ```sh
  sudo apt install mysql-server
  sudo mysql_secure_installation    # 安全配置
  ```

- 安裝 Nginx（反向代理）

  ```sh
  sudo apt install nginx
  sudo systemctl start nginx
  ```

---

### 2. 打包 Spring Boot 應用

在本地開發環境生成可執行 JAR：

- Maven 項目

  ```sh
  mvnw clean package
  ```

- Gradle 項目

  ```sh
  gradle bootJar
  ```

生成的 JAR 通常在 `target/` 或 `build/libs/` 目錄下。

---

### 3. 上傳文件到伺服器

使用 SCP 或 SFTP 工具上傳 JAR 文件：

```sh
scp -i "pem-key" "path-to-your-app.jar" user@your-server-ip:"destination-path"
```

---

### 4. 伺服器端配置

- 創建服務用戶（可選）

  ```sh
  sudo adduser springbootuser
  sudo usermod -aG sudo springbootuser   # 授予 sudo 權限（按需）
  ```

- 創建 Systemd 服務（管理應用進程）

  創建服務文件：

  ```sh
  sudo nano /etc/systemd/system/springboot.service
  ```

  内容示例：

  ```
  [Unit]
  Description=Spring Boot App
  After=syslog.target

  [Service]
  User=springbootuser
  ExecStart=/usr/bin/java -jar /home/springbootuser/app/your-app.jar
  SuccessExitStatus=143
  Restart=always

  [Install]
  WantedBy=multi-user.target
  ```

- 启动服务：

  ```sh
  sudo systemctl daemon-reload
  sudo systemctl start springboot
  sudo systemctl enable springboot   # 開機自啟
  ```

---

### 5. 配置 Nginx 反向代理

編輯 Nginx 配置：

```sh
sudo nano /etc/nginx/sites-available/your-domain
```

内容示例：

```
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:8080;  # Spring Boot預設端口
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

啟用配置並測試：

```sh
sudo ln -s /etc/nginx/sites-available/your-domain /etc/nginx/sites-enabled/
sudo nginx -t        # 測試語法
sudo systemctl restart nginx
```

---

### 6. 配置防火牆

允許 HTTP/HTTPS 和 SSH：

```sh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

---

### 7. 驗證部署

- 訪問 `http://your-server-ip` 查看應用。
- 檢查日誌：

  ```sh
  journalctl -u springboot -f   # 實時日誌
  ```

---

### 常見問題

- **端口衝突**：確保 Spring Boot 的 `server.port` 與 Nginx 配置一致。
- **資料庫連接**：檢查 `application.properties` 中的資料庫 URL、用戶名和密碼。
- **權限問題**：確保 JAR 文件和目錄有正確權限（`chmod +x`）。
- **HTTPS**：如需 HTTPS，可使用 Let's Encrypt 證書（通過 Certbot 工具）。

---
