<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings</title>
    <link rel="stylesheet" href="/css/general.css" />
    <link rel="stylesheet" href="/css/navigation.css" />
    <link rel="stylesheet" href="/css/settings.css" />
  </head>
  <body>
    <th:block th:replace="~{TopNav.html}"></th:block>
    
    <div class="content-wrapper">
      <div class="setting-container">
        <div class="setting-section">
          <label for="apiKeyInput">DeepSeek API Key</label>
          <input
            id="apiKeyInput"
            type="password"
            placeholder="Enter your DeepSeek API Key"
          />
          <div class="btn-group">
            <button id="saveApiKeyBtn" class="btn">Save Key</button>
            <button id="clearApiKeyBtn" class="btn btn-danger">Clear Key</button>
          </div>
          <div class="setting-status" id="statusMsg">Saved!</div>
        </div>

        <hr class="setting-divider" />

        <div class="setting-section">
          <label for="systemPromptInput">System Prompt (Default)</label>
          <textarea
            id="systemPromptInput"
            placeholder="Set a default system prompt for DeepSeek chat"
            rows="3"
          ></textarea>
          <div class="btn-group">
            <button id="saveSystemPromptBtn" class="btn">Save Prompt</button>
            <button id="clearSystemPromptBtn" class="btn btn-danger">Clear Prompt</button>
          </div>
          <div class="setting-status" id="systemPromptStatus">Saved!</div>
        </div>
      </div>
    </div>
    <script>
      const apiKeyInput = document.getElementById("apiKeyInput");
      const saveApiKeyBtn = document.getElementById("saveApiKeyBtn");
      const clearApiKeyBtn = document.getElementById("clearApiKeyBtn");
      const statusMsg = document.getElementById("statusMsg");

      // System prompt elements
      const systemPromptInput = document.getElementById("systemPromptInput");
      const saveSystemPromptBtn = document.getElementById(
        "saveSystemPromptBtn"
      );
      const clearSystemPromptBtn = document.getElementById(
        "clearSystemPromptBtn"
      );
      const systemPromptStatus = document.getElementById("systemPromptStatus");

      // Load API key from localStorage if present
      const storedKey = localStorage.getItem("deepseek_api_key");
      if (storedKey) {
        apiKeyInput.value = storedKey;
      }

      // Load system prompt from localStorage if present
      const storedPrompt = localStorage.getItem("deepseek_system_prompt");
      if (storedPrompt) {
        systemPromptInput.value = storedPrompt;
      }

      saveApiKeyBtn.onclick = function () {
        localStorage.setItem("deepseek_api_key", apiKeyInput.value);
        statusMsg.textContent = "Saved!";
        statusMsg.style.color = "#28a745";
        statusMsg.style.display = "block";
        setTimeout(() => {
          statusMsg.style.display = "none";
        }, 1200);
      };
      clearApiKeyBtn.onclick = function () {
        localStorage.removeItem("deepseek_api_key");
        apiKeyInput.value = "";
        statusMsg.textContent = "Cleared!";
        statusMsg.style.color = "#dc3545";
        statusMsg.style.display = "block";
        setTimeout(() => {
          statusMsg.style.display = "none";
        }, 1200);
      };

      saveSystemPromptBtn.onclick = function () {
        localStorage.setItem("deepseek_system_prompt", systemPromptInput.value);
        systemPromptStatus.textContent = "Saved!";
        systemPromptStatus.style.color = "#28a745";
        systemPromptStatus.style.display = "block";
        setTimeout(() => {
          systemPromptStatus.style.display = "none";
        }, 1200);
      };
      clearSystemPromptBtn.onclick = function () {
        localStorage.removeItem("deepseek_system_prompt");
        systemPromptInput.value = "";
        systemPromptStatus.textContent = "Cleared!";
        systemPromptStatus.style.color = "#dc3545";
        systemPromptStatus.style.display = "block";
        setTimeout(() => {
          systemPromptStatus.style.display = "none";
        }, 1200);
      };
    </script>
  </body>
</html>
